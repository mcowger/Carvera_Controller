#:include addons/probing/preview/ProbingPreviewPopup.kv
#:include addons/probing/ProbingControls.kv
#:include addons/probing/operations/OutsideCorner/OutsideCornerSettings.kv
#:include addons/probing/operations/InsideCorner/InsideCornerSettings.kv
#:include addons/probing/operations/SingleAxis/SingleAxisProbeSettings.kv


<ProbingPopup>:
    title:"Probing"
    size_hint: 0.8, 0.8
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    auto_dismiss: False
    step_xy: step_xy
    step_z: step_z
    step_a: step_a

    GridLayout:
        cols:1
        rows:3
        spacing: dp(0)
        padding: dp(3)
        GridLayout:
            cols:2
            rows:2
            spacing: dp(10)
            padding: dp(3)

            TabbedPanel:
                do_default_tab: False
                tab_width: dp(111)
                TabbedPanelItem:
                    text: tr._('Outside Corners')
                    GridLayout:
                        cols:2
                        rows:1
                        size_hint:1, 1
                        spacing:dp(10)
                        padding:dp(10)
                        GridLayout:
                            size_hint_x: .5
                            cols: 2
                            rows: 2
                            spacing: dp(8)
                            padding: 10

                            ProbeButton:
                                on_press: root.on_outside_corner_probing_pressed("TopLeft")
                                image: 'addons/probing/data/icons_1024x768/outside_corner/X+Y-.png'
                            ProbeButton:
                                on_press: root.on_outside_corner_probing_pressed("TopRight")
                                image: 'addons/probing/data/icons_1024x768/outside_corner/X-Y-.png'
                            ProbeButton:
                                on_press: root.on_outside_corner_probing_pressed("BottomLeft")
                                image: 'addons/probing/data/icons_1024x768/outside_corner/X+Y+.png'
                            ProbeButton:
                                on_press: root.on_outside_corner_probing_pressed("BottomRight")
                                image: 'addons/probing/data/icons_1024x768/outside_corner/X-Y+.png'

                        BoxLayout:
                            size_hint_x: .5
                            OutsideCornerSettings:
                                id: outside_corner_settings

                TabbedPanelItem:
                    text: tr._('Inside Corners')
                    GridLayout:
                        cols:2
                        rows:1
                        size_hint:1, 1
                        spacing:dp(10)
                        padding:dp(10)
                        GridLayout:
                            size_hint_x: .5
                            cols: 2
                            rows: 2
                            spacing: dp(8)
                            padding: 10

                            ProbeButton:
                                on_press: root.on_inside_corner_probing_pressed("TopLeft")
                                image: 'addons/probing/data/icons_1024x768/inside_corner/inX+Y-.png'
                            ProbeButton:
                                on_press: root.on_inside_corner_probing_pressed("TopRight")
                                image: 'addons/probing/data/icons_1024x768/inside_corner/inX-Y-.png'
                            ProbeButton:
                                on_press: root.on_inside_corner_probing_pressed("BottomLeft")
                                image: 'addons/probing/data/icons_1024x768/inside_corner/inX+Y+.png'
                            ProbeButton:
                                on_press: root.on_inside_corner_probing_pressed("BottomRight")
                                image: 'addons/probing/data/icons_1024x768/inside_corner/inX-Y+.png'

                        BoxLayout:
                            size_hint_x: .5
                            InsideCornerSettings:
                                id: inside_corner_settings

                TabbedPanelItem:
                    text: tr._('Single Axis')
                    GridLayout:
                        cols:2
                        rows:1
                        size_hint:1, 1
                        spacing:dp(10)
                        padding:dp(10)

                        GridLayout:
                            size_hint_x: .5
                            cols: 3
                            rows: 3
                            spacing: dp(8)
                            padding: 10

                            EmptySpace:
                                #nothing

                            ProbeButton:
                                on_press: root.on_single_axis_probing_pressed("Top")
                                image: 'addons/probing/data/icons_1024x768/single_axis/Y-.png'

                            EmptySpace:
                                #nothing

                            ProbeButton:
                                on_press: root.on_single_axis_probing_pressed("Left")
                                image: 'addons/probing/data/icons_1024x768/single_axis/X+.png'

                            ProbeButton:
                                on_press: root.on_single_axis_probing_pressed("WorkpieceTop")
                                image: 'addons/probing/data/icons_1024x768/single_axis/Z-.png'

                            ProbeButton:
                                on_press: root.on_single_axis_probing_pressed("Right")
                                image: 'addons/probing/data/icons_1024x768/single_axis/X-.png'

                            EmptySpace:
                                #nothing

                            ProbeButton:
                                on_press: root.on_single_axis_probing_pressed("Bottom")
                                image: 'addons/probing/data/icons_1024x768/single_axis/Y+.png'

                            EmptySpace:
                                #nothing

                        BoxLayout:
                            size_hint_x: .5
                            SingleAxisProbeSettings:
                                id: single_axis_settings


        #jogging controls
        BoxLayout:
            spacing: '0dp'
            size_hint_y: None
            height: '120dp'
            GridLayout:
                cols:5
                rows:1
                size_hint:1, 1
                spacing:dp(0)
                padding:dp(0)
                BoxLayout:
                    disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                    padding: '25dp'
                    orientation: 'horizontal'
                #X and Y controls
                BoxLayout:
                    orientation: 'horizontal'
                    padding: '0dp'
                    canvas.before:
                        Color:
                            rgba: 40/255, 40/255, 40/255, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [self.height / 2,self.height / 2]
                    BoxLayout:
                        disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                        padding: '0dp'
                        canvas.before:
                            Color:
                                rgba: 50/255, 50/255, 50/255, 1
                            Ellipse:
                                pos: self.pos
                                size: self.size
                        GridLayout:
                            cols: 3
                            rows: 3
                            GridBoxLayout:
                            GridBoxLayout:
                                SmallRoundButton:
                                    text: 'Y-'
                                    on_release: app.root.controller.jog_with_speed("Y-{}".format(root.step_xy.text), app.root.jog_speed)
                            GridBoxLayout:
                            GridBoxLayout:
                                SmallRoundButton:
                                    text: 'X-'
                                    on_release: app.root.controller.jog_with_speed("X-{}".format(root.step_xy.text), app.root.jog_speed)
                            GridBoxLayout:
                                Label:
                                Spinner:
                                    id: step_xy
                                    center: 0.5, 0.5
                                    size_hint_y: None
                                    height: '30dp'
                                    text: '10'
                                    values: '10', '1', '0.1', '0.01', '0.005'
                                Label:
                            GridBoxLayout:
                                SmallRoundButton:
                                    text: 'X+'
                                    on_release: app.root.controller.jog_with_speed("X{}".format(root.step_xy.text), app.root.jog_speed)
                            GridBoxLayout:
                            GridBoxLayout:
                                SmallRoundButton:
                                    text: 'Y+'
                                    on_release: app.root.controller.jog_with_speed("Y{}".format(root.step_xy.text), app.root.jog_speed)
                            GridBoxLayout:
                BoxLayout:
                    disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                    padding: '0dp'
                    orientation: 'horizontal'
                #A and Z controls
                BoxLayout:
                    disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                    padding: '0dp'
                    orientation: 'horizontal'
                    canvas.before:
                        Color:
                            rgba: 50/255, 50/255, 50/255, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [5,5]
                    GridLayout:
                        size_hint_y: 0.9
                        cols: 2
                        rows: 3
                        GridBoxLayout:
                            SmallRoundButton:
                                text: 'A+'
                                height: 30
                                on_release: app.root.controller.jog_with_speed("A{}".format(root.step_a.text), app.root.jog_speed)
                        GridBoxLayout:
                            SmallRoundButton:
                                text: 'Z+'
                                height: 30
                                on_release: app.root.controller.jog_with_speed("Z{}".format(root.step_z.text), app.root.jog_speed)
                        GridBoxLayout:
                            Label:
                            Spinner:
                                id: step_a
                                center: 0.5, 0.5
                                size_hint_y: 0.9
                                height: '30dp'
                                text: '90'
                                values: '90', '10', '1', '0.1'
                            Label:
                        GridBoxLayout:
                            Label:
                            Spinner:
                                id: step_z
                                center: 0.5, 0.5
                                size_hint_y: 0.9
                                height: '30dp'
                                text: '1'
                                values: '10', '1', '0.1', '0.01', '0.005'
                            Label:
                        GridBoxLayout:
                            SmallRoundButton:
                                text: 'A-'
                                height: 30
                                on_release: app.root.controller.jog_with_speed("A-{}".format(root.step_a.text), app.root.jog_speed)
                        GridBoxLayout:
                            SmallRoundButton:
                                text: 'Z-'
                                height: 30
                                on_release: app.root.controller.jog_with_speed("Z-{}".format(root.step_z.text), app.root.jog_speed)
                BoxLayout:
                    disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                    padding: '25dp'
                    orientation: 'horizontal'

        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_close
                text: tr._('Close')
                on_release: root.dismiss()
